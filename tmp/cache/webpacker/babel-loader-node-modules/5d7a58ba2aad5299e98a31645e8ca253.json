{"ast":null,"code":"/* --- chat --- */\nimport { unsubAll } from '../chat/index';\n/* ------------ */\n\nimport { popWindows, popChoise, pop404 } from '../popWindows/popWindows';\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};‘:“\\\\|,.<>\\/?~]/;\nvar SEARCH = {};\nvar username = \"\";\nSEARCH.matches = new Backbone.Collection();\nSEARCH.matches.comparator = \"id\";\nSEARCH.user = new Backbone.Model();\nSEARCH.ViewBar = Backbone.View.extend({\n  events: {\n    \"keypress input[type='text']\": \"search\"\n  },\n  search: function search(event) {\n    if (event.which == global.ENTER_KEY) {\n      username = $(event.currentTarget).val();\n      $(event.currentTarget).val(\"\");\n\n      if (username != \"\" && !format.test(username)) {\n        this.collection.fetch({\n          url: \"/users/\" + username,\n          reset: true\n        });\n      }\n    }\n  }\n});\nSEARCH.ViewUser = Backbone.View.extend({\n  events: {\n    \"click input[value='ban']\": \"ban\",\n    \"click input[value='unban']\": \"unban\"\n  },\n  initialize: function initialize() {\n    this.collection.on(\"sync\", this.render, this);\n  },\n  render: function render() {\n    console.log(this.collection.length);\n    this.$el.attr(\"class\", \"show\");\n    this.$(\"h3\").html(username);\n  },\n  ban: function ban() {\n    this.model.fetch({\n      url: \"/user/ban/\" + this.$(\"h3\").html()\n    });\n  },\n  unban: function unban() {\n    this.model.fetch({\n      url: \"/user/unban/\" + this.$(\"h3\").html()\n    });\n  }\n});\nSEARCH.ViewMatches = Backbone.View.extend({\n  template: _.template(\"<li>\" + \"<%- matchType %>: <%- playerLeft %> vs <%- playerRight %>\" + \" [<%- scoreLeft %> - <%- scoreRight %>]\" + \"</li>\"),\n  initialize: function initialize() {\n    this.collection.on(\"sync\", this.render, this);\n  },\n  render: function render() {\n    this.$(\"ul\").html(\"\");\n    this.collection.each(this.renderItem, this);\n  },\n  renderItem: function renderItem(item) {\n    this.$(\"ul\").append(this.template(item.attributes));\n  }\n});\nSEARCH.View = Backbone.View.extend({\n  el: $(\"#main\"),\n  initialize: function initialize() {\n    this.$el.html($(\"#searchTemplate\").html());\n    new SEARCH.ViewBar({\n      el: this.$(\"#searchBar\"),\n      collection: this.collection\n    });\n    new SEARCH.ViewUser({\n      el: this.$(\"#searchUser\"),\n      model: this.model,\n      collection: this.collection\n    });\n    new SEARCH.ViewMatches({\n      el: this.$(\"#searchMatches\"),\n      collection: this.collection\n    });\n  }\n});\n\nSEARCH.display = function () {\n  window.location.hash = \"#search\";\n  /* --- chat --- */\n\n  unsubAll();\n  /* ------------ */\n\n  new SEARCH.View({\n    model: SEARCH.user,\n    collection: SEARCH.matches\n  });\n};\n\n$(\"#nav input[value='Search']\").on(\"click\", SEARCH.display);\nexport default SEARCH;","map":{"version":3,"sources":["/pong_rails/app/javascript/nav/search.js"],"names":["unsubAll","popWindows","popChoise","pop404","format","SEARCH","username","matches","Backbone","Collection","comparator","user","Model","ViewBar","View","extend","events","search","event","which","global","ENTER_KEY","$","currentTarget","val","test","collection","fetch","url","reset","ViewUser","initialize","on","render","console","log","length","$el","attr","html","ban","model","unban","ViewMatches","template","_","each","renderItem","item","append","attributes","el","display","window","location","hash"],"mappings":"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","sourcesContent":["/* --- chat --- */\nimport {unsubAll} from '../chat/index'\n/* ------------ */\nimport {popWindows,popChoise, pop404} from '../popWindows/popWindows'\n\n\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};‘:“\\\\|,.<>\\/?~]/;\n\nlet SEARCH = {};\nlet username = \"\";\n\nSEARCH.matches = new Backbone.Collection();\nSEARCH.matches.comparator = \"id\";\nSEARCH.user = new Backbone.Model();\n\nSEARCH.ViewBar = Backbone.View.extend({\n\tevents: {\n\t\t\"keypress input[type='text']\": \"search\",\n\t},\n\tsearch: function(event) {\n\t\tif (event.which == global.ENTER_KEY) {\n\t\t\tusername = $(event.currentTarget).val();\n\t\t\t$(event.currentTarget).val(\"\");\n\t\t\tif (username != \"\" && !format.test(username)) {\n\t\t\t\tthis.collection.fetch({\n\t\t\t\t\turl: \"/users/\" + username,\n\t\t\t\t\treset: true\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n\nSEARCH.ViewUser = Backbone.View.extend({\n\tevents: {\n\t\t\"click input[value='ban']\": \"ban\",\n\t\t\"click input[value='unban']\": \"unban\"\n\t},\n\tinitialize: function() {\n\t\tthis.collection.on(\"sync\", this.render, this);\n\t},\n\trender: function() {\n\t\tconsole.log(this.collection.length)\n\t\t\tthis.$el.attr(\"class\", \"show\");\n\t\t\tthis.$(\"h3\").html(username);\n\t},\n\tban: function() {\n\t\tthis.model.fetch({ url: \"/user/ban/\" + this.$(\"h3\").html() });\n\t},\n\tunban: function() {\n\t\tthis.model.fetch({ url: \"/user/unban/\" + this.$(\"h3\").html() });\n\t}\n});\n\nSEARCH.ViewMatches = Backbone.View.extend({\n\ttemplate: _.template(\"<li>\" +\n\t\t\t\t\t\t \"<%- matchType %>: <%- playerLeft %> vs <%- playerRight %>\" +\n\t\t\t\t\t\t \" [<%- scoreLeft %> - <%- scoreRight %>]\" +\n\t\t\t\t\t\t \"</li>\"),\n\tinitialize: function() {\n\t\tthis.collection.on(\"sync\", this.render, this);\n\t},\n\trender: function() {\n\t\tthis.$(\"ul\").html(\"\");\n\t\tthis.collection.each(this.renderItem, this);\n\t},\n\trenderItem: function(item) {\n\t\tthis.$(\"ul\").append(this.template(item.attributes));\n\n\t}\n});\n\nSEARCH.View = Backbone.View.extend({\n\tel: $(\"#main\"),\n\tinitialize: function() {\n\t\tthis.$el.html($(\"#searchTemplate\").html());\n\n\t\tnew SEARCH.ViewBar({ el: this.$(\"#searchBar\"),\n\t\t\t\t\t\t\t  collection: this.collection });\n\t\tnew SEARCH.ViewUser({ el: this.$(\"#searchUser\"),\n\t\t\t\t\t\t\t  model: this.model,\n\t\t\t\t\t\t\t  collection: this.collection });\n\t\tnew SEARCH.ViewMatches({ el: this.$(\"#searchMatches\"),\n\t\t\t\t\t\t\t\t collection: this.collection });\n\t}\n});\n\nSEARCH.display = function() {\n\twindow.location.hash = \"#search\";\n\n\t/* --- chat --- */\n\tunsubAll();\n\t/* ------------ */\n\n\tnew SEARCH.View({ model: SEARCH.user, collection: SEARCH.matches });\n}\n\n$(\"#nav input[value='Search']\").on(\"click\", SEARCH.display);\n\nexport default SEARCH;\n"]},"metadata":{},"sourceType":"module"}