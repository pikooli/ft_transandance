{"ast":null,"code":"/* --- chat --- */\nimport { unsubAll } from '../chat/index';\n/* ------------ */\n\nimport consumer from \"../channels/consumer\";\nimport PONG from \"./pong\";\nvar WATCH = {};\nWATCH.channel = consumer.subscriptions.create(\"WatchChannel\", {\n  received: function received(data) {\n    WATCH.ball.render(data.ball);\n    WATCH.leftPaddle.render(data.leftPaddle);\n    WATCH.rightPaddle.render(data.rightPaddle);\n  }\n});\nWATCH.CollectionUsers = Backbone.Collection.extend({\n  url: function url() {\n    return \"/watch\";\n  }\n});\nWATCH.users = new WATCH.CollectionUsers();\nWATCH.ViewGames = Backbone.View.extend({\n  events: {\n    \"click input[type='button']\": \"watch\"\n  },\n  template: _.template(\"<li>\" + \"<label><%- username %> [<%- status %>]</label>\" + \"<input data-name=<%- userid %> type='button'>\" + \"</li>\"),\n  initialize: function initialize() {\n    this.collection.on(\"sync\", this.render, this);\n    this.collection.fetch();\n  },\n  render: function render() {\n    this.$(\"ul\").html(\"\");\n    this.collection.each(this.renderItem, this);\n  },\n  renderItem: function renderItem(item) {\n    this.$(\"ul\").append(this.template(item.attributes));\n  },\n  watch: function watch(event) {\n    var user = $(event.currentTarget).data(\"name\");\n    WATCH.channel.perform(\"follow\", {\n      userid: user\n    });\n  }\n});\nWATCH.ViewMatch = Backbone.View.extend({\n  render: function render(attributes) {\n    this.$el.attr(attributes);\n  }\n});\nWATCH.View = Backbone.View.extend({\n  el: $(\"#main\"),\n  initialize: function initialize() {\n    this.$el.html($(\"#watchTemplate\").html());\n    new WATCH.ViewGames({\n      el: this.$(\"#watchGames\"),\n      collection: WATCH.users\n    });\n    this.$(\"svg\").attr({\n      width: PONG.width,\n      height: PONG.height\n    });\n    this.$(\"svg #watchBackground\").attr({\n      width: \"100%\",\n      height: \"100%\",\n      fill: PONG.backgroundFill\n    });\n    this.$(\"svg #watchNet\").attr({\n      x1: PONG.width / 2,\n      y1: 0,\n      x2: PONG.width / 2,\n      y2: PONG.height,\n      stroke: PONG.fill\n    });\n    WATCH.leftPaddle = new WATCH.ViewMatch({\n      el: this.$(\"svg #watchLeftPaddle\")\n    });\n    WATCH.rightPaddle = new WATCH.ViewMatch({\n      el: this.$(\"svg #watchRightPaddle\")\n    });\n    WATCH.ball = new WATCH.ViewMatch({\n      el: this.$(\"svg #watchBall\")\n    });\n  }\n});\n\nWATCH.display = function (event) {\n  if (event && $(event.currentTarget).val() == \"Watch\" || window.location.hash == \"#watch\") {\n    window.location.hash = \"#watch\";\n    /* --- chat --- */\n\n    unsubAll();\n    /* ------------ */\n\n    new WATCH.View();\n  } else {\n    WATCH.channel.perform(\"unfollow\");\n  }\n};\n\n$(\"#nav input[type='button']\").on(\"click\", WATCH.display);\nexport default WATCH;","map":{"version":3,"sources":["/pong_rails/app/javascript/nav/watch.js"],"names":["unsubAll","consumer","PONG","WATCH","channel","subscriptions","create","received","data","ball","render","leftPaddle","rightPaddle","CollectionUsers","Backbone","Collection","extend","url","users","ViewGames","View","events","template","_","initialize","collection","on","fetch","$","html","each","renderItem","item","append","attributes","watch","event","user","currentTarget","perform","userid","ViewMatch","$el","attr","el","width","height","fill","backgroundFill","x1","y1","x2","y2","stroke","display","val","window","location","hash"],"mappings":"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","sourcesContent":["/* --- chat --- */\nimport {unsubAll} from '../chat/index'\n/* ------------ */\n\nimport consumer from \"../channels/consumer\"\nimport PONG from \"./pong\";\n\nlet WATCH = {};\n\nWATCH.channel = consumer.subscriptions.create(\"WatchChannel\", {\n\treceived(data) {\n\t\tWATCH.ball.render(data.ball);\n\t\tWATCH.leftPaddle.render(data.leftPaddle);\n\t\tWATCH.rightPaddle.render(data.rightPaddle);\n\t}\n});\n\nWATCH.CollectionUsers = Backbone.Collection.extend({\n\turl: function() {\n\t\treturn \"/watch\";\n\t}\n});\nWATCH.users = new WATCH.CollectionUsers();\n\nWATCH.ViewGames = Backbone.View.extend({\n\tevents: {\n\t\t\"click input[type='button']\": \"watch\"\n\t},\n\ttemplate: _.template(\"<li>\" +\n\t\t\t\t\t\t \"<label><%- username %> [<%- status %>]</label>\" +\n\t\t\t\t\t\t \"<input data-name=<%- userid %> type='button'>\" +\n\t\t\t\t\t\t \"</li>\"),\n\tinitialize: function() {\n\t\tthis.collection.on(\"sync\", this.render, this);\n\t\tthis.collection.fetch();\n\t},\n\trender: function() {\n\t\tthis.$(\"ul\").html(\"\");\n\t\tthis.collection.each(this.renderItem, this);\n\t},\n\trenderItem: function(item) {\n\t\tthis.$(\"ul\").append(this.template(item.attributes));\n\t},\n\twatch: function(event) {\n\t\tlet user = $(event.currentTarget).data(\"name\");\n\t\tWATCH.channel.perform(\"follow\", { userid: user });\n\t}\n});\n\nWATCH.ViewMatch = Backbone.View.extend({\n\trender: function(attributes) {\n\t\tthis.$el.attr(attributes);\n\t}\n});\n\nWATCH.View = Backbone.View.extend({\n\tel: $(\"#main\"),\n\tinitialize: function() {\n\t\tthis.$el.html($(\"#watchTemplate\").html());\n\n\t\tnew WATCH.ViewGames({\n\t\t\tel: this.$(\"#watchGames\"),\n\t\t\tcollection: WATCH.users\n\t\t});\n\n\t\tthis.$(\"svg\").attr({\n\t\t\twidth: PONG.width,\n\t\t\theight: PONG.height\n\t\t});\n\t\tthis.$(\"svg #watchBackground\").attr({\n\t\t\twidth: \"100%\",\n\t\t\theight: \"100%\",\n\t\t\tfill: PONG.backgroundFill\n\t\t});\n\t\tthis.$(\"svg #watchNet\").attr({\n\t\t\tx1: (PONG.width / 2),\n\t\t\ty1: 0,\n\t\t\tx2: (PONG.width / 2),\n\t\t\ty2: PONG.height,\n\t\t\tstroke: PONG.fill\n\t\t});\n\t\tWATCH.leftPaddle = new WATCH.ViewMatch({\n\t\t\tel: this.$(\"svg #watchLeftPaddle\")\n\t\t});\n\t\tWATCH.rightPaddle = new WATCH.ViewMatch({\n\t\t\tel: this.$(\"svg #watchRightPaddle\")\n\t\t});\n\t\tWATCH.ball = new WATCH.ViewMatch({\n\t\t\tel: this.$(\"svg #watchBall\")\n\t\t});\n\t}\n});\n\nWATCH.display = function(event) {\n\tif ((event && $(event.currentTarget).val() == \"Watch\")\n\t\t|| window.location.hash == \"#watch\") {\n\t\twindow.location.hash = \"#watch\";\n\n\t\t/* --- chat --- */\n\t\tunsubAll();\n\t\t/* ------------ */\n\n\t\tnew WATCH.View();\n\t}\n\telse {\n\t\tWATCH.channel.perform(\"unfollow\");\n\t}\n}\n\n$(\"#nav input[type='button']\").on(\"click\", WATCH.display);\n\nexport default WATCH;\n"]},"metadata":{},"sourceType":"module"}