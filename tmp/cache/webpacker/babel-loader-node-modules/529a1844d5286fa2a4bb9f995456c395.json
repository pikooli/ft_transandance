{"ast":null,"code":"/* --- chat --- */\nimport { unsubAll } from '../chat/index';\nimport { personnalchannel } from '../chat/persochannel_channel';\nimport { subscGuild } from '../channels/guild_channel';\n/* ------------ */\n\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};‘:“\\\\|,.<>\\/?~]/;\nvar USER = {};\n/* namespace */\n\nUSER.Model = Backbone.Model.extend({\n  url: function url() {\n    return \"/user\";\n  }\n});\nUSER.CollectionFriends = Backbone.Collection.extend({\n  url: function url() {\n    return \"/user/friends\";\n  }\n});\nUSER.CollectionMatches = Backbone.Collection.extend({\n  comparator: \"id\",\n  url: function url() {\n    return \"/user/matches\";\n  }\n});\nUSER.model = new USER.Model();\nUSER.friends = new USER.CollectionFriends();\nUSER.matches = new USER.CollectionMatches();\nUSER.ViewAvatar = Backbone.View.extend({\n  events: {\n    \"click input[type='submit']\": \"reload\"\n  },\n  reload: function reload() {\n    window.location.reload(true);\n  }\n});\nUSER.ViewName = Backbone.View.extend({\n  events: {\n    \"dblclick label\": \"edit\",\n    \"keypress input\": \"save\"\n  },\n  initialize: function initialize() {\n    this.template = _.template(_.unescape(this.$el.html()));\n    this.$el.html(this.template(this.model.attributes));\n  },\n  edit: function edit(event) {\n    $(event.currentTarget).html(\"Username: \");\n    this.$el.children(\"input\").val(this.model.get(\"username\"));\n    this.$el.children(\"input\").attr(\"class\", \"show\");\n  },\n  save: function save(event) {\n    if (event.which == global.ENTER_KEY) {\n      var username = this.$el.children(\"input\").val();\n\n      if (username != \"\" && !format.test(username)) {\n        this.model.save({\n          username: username\n        }, {\n          patch: true,\n          wait: true,\n          headers: {\n            \"X-CSRF-Token\": global.CSRF()\n          }\n        });\n      }\n    }\n  }\n});\nUSER.ViewInfo = Backbone.View.extend({\n  events: {\n    \"click #infoAdmin\": \"admin\",\n    \"click #infoMatch\": \"match\"\n  },\n  initialize: function initialize() {\n    this.template = _.template(_.unescape(this.$el.html()));\n    this.$el.html(this.template(this.model.attributes));\n  },\n  admin: function admin(event) {\n    var value;\n    if ($(event.currentTarget).val() == \"false\") value = true;else value = false;\n    this.model.save({\n      admin: value\n    }, {\n      patch: true,\n      wait: true,\n      headers: {\n        \"X-CSRF-Token\": global.CSRF()\n      }\n    });\n  },\n  match: function match() {\n    this.model.save({\n      match: \"none\",\n      status: \"online\"\n    }, {\n      patch: true,\n      wait: true,\n      headers: {\n        \"X-CSRF-Token\": global.CSRF()\n      }\n    });\n  }\n});\nUSER.ViewFriends = Backbone.View.extend({\n  events: {\n    \"keypress input[type='text']\": \"add\",\n    \"click input[type='button']\": \"remove\"\n  },\n  template: _.template(\"<li>\" + \"<label><%- username %> [<%- status %>]</label>\" + \"<input data-name=<%- userid %> type='button'>\" + \"</li>\"),\n  initialize: function initialize() {\n    this.collection.on(\"sync\", this.render, this);\n    this.collection.fetch();\n  },\n  render: function render() {\n    this.$(\"ul\").html(\"\");\n    this.collection.each(this.renderItem, this);\n  },\n  renderItem: function renderItem(item) {\n    this.$(\"ul\").append(this.template(item.attributes));\n  },\n  add: function add(event) {\n    if (event.which == global.ENTER_KEY) {\n      var friend = $(event.currentTarget).val();\n      $(event.currentTarget).val(\"\");\n      this.collection.fetch({\n        url: \"/user/friends/\" + friend + \"/add\"\n      });\n    }\n  },\n  remove: function remove(event) {\n    var friend = $(event.currentTarget).data(\"name\");\n    this.collection.fetch({\n      url: \"/user/friends/\" + friend + \"/remove\"\n    });\n  }\n});\nUSER.ViewMatches = Backbone.View.extend({\n  template: _.template(\"<li>\" + \"<%- matchType %>: <%- playerLeft %> vs <%- playerRight %>\" + \" [<%- scoreLeft %> - <%- scoreRight %>]\" + \"</li>\"),\n  initialize: function initialize() {\n    this.collection.on(\"sync\", this.render, this);\n    this.collection.fetch();\n  },\n  render: function render() {\n    this.$(\"ul\").html(\"\");\n    this.collection.each(this.renderItem, this);\n  },\n  renderItem: function renderItem(item) {\n    this.$(\"ul\").append(this.template(item.attributes));\n  }\n});\nUSER.ViewTotp = Backbone.View.extend({\n  events: {\n    \"click input[value='show']\": \"show\",\n    \"click input[value='hide']\": \"hide\",\n    \"click input[value='activate']\": \"activate\",\n    \"click input[value='desactivate']\": \"desactivate\"\n  },\n  initialize: function initialize() {\n    if (this.model.get(\"TFA?\") == true) this.$(\"input[value='TFA?']\").val(\"desactivate\");else this.$(\"input[value='TFA?']\").val(\"activate\");\n  },\n  show: function show(event) {\n    $(event.currentTarget).val(\"hide\");\n    this.$(\"label\").html(this.model.get(\"otp_secret\"));\n    this.$(\"label\").attr(\"class\", \"show\");\n  },\n  hide: function hide(event) {\n    $(event.currentTarget).val(\"show\");\n    this.$(\"label\").html(\"\");\n    this.$(\"label\").attr(\"class\", \"hide\");\n  },\n  activate: function activate(event) {\n    $(event.currentTarget).val(\"desactivate\");\n    this.model.save({\n      \"TFA?\": true\n    }, {\n      patch: true,\n      wait: true,\n      headers: {\n        \"X-CSRF-Token\": global.CSRF()\n      }\n    });\n  },\n  desactivate: function desactivate(event) {\n    $(event.currentTarget).val(\"activate\");\n    this.model.save({\n      \"TFA?\": false\n    }, {\n      patch: true,\n      wait: true,\n      headers: {\n        \"X-CSRF-Token\": global.CSRF()\n      }\n    });\n  }\n});\nUSER.View = Backbone.View.extend({\n  el: \"#main\",\n  initialize: function initialize() {\n    USER.model.on(\"sync\", this.render, this);\n    USER.model.fetch();\n  },\n  render: function render() {\n    this.$el.html($(\"#userTemplate\").html());\n    new USER.ViewAvatar({\n      el: this.$(\"#userAvatar\"),\n      model: USER.model\n    });\n    new USER.ViewName({\n      el: this.$(\"#userName\"),\n      model: USER.model\n    });\n    new USER.ViewInfo({\n      el: this.$(\"#userInfo\"),\n      model: USER.model\n    });\n    new USER.ViewFriends({\n      el: this.$(\"#userFriends\"),\n      collection: USER.friends\n    });\n    new USER.ViewMatches({\n      el: this.$(\"#userMatches\"),\n      collection: USER.matches\n    });\n    new USER.ViewTotp({\n      el: this.$(\"#userTotp\"),\n      model: USER.model\n    });\n\n    if (USER.model.get('guild_id') && USER.model.get('G_anagram')) {\n      $('#anagram').html('[' + USER.model.get('G_anagram') + ']');\n    }\n\n    $('#playerUsername').html(USER.model.get('username'));\n    personnalchannel();\n    subscGuild();\n  }\n});\n\nUSER.display = function () {\n  window.location.hash = \"#user\";\n  /* --- chat --- */\n\n  unsubAll();\n  USER.model.unbind(); // i have add this to remove the multiple 'on' on the model user , don't know if it will cause problem to you\n  // remove it if it make probleme\n\n  /* ------------ */\n\n  new USER.View();\n};\n\n$(\"#nav input[value='User']\").on(\"click\", USER.display);\nexport default USER;","map":{"version":3,"sources":["/pong_rails/app/javascript/nav/user.js"],"names":["unsubAll","personnalchannel","subscGuild","format","USER","Model","Backbone","extend","url","CollectionFriends","Collection","CollectionMatches","comparator","model","friends","matches","ViewAvatar","View","events","reload","window","location","ViewName","initialize","template","_","unescape","$el","html","attributes","edit","event","$","currentTarget","children","val","get","attr","save","which","global","ENTER_KEY","username","test","patch","wait","headers","CSRF","ViewInfo","admin","value","match","status","ViewFriends","collection","on","render","fetch","each","renderItem","item","append","add","friend","remove","data","ViewMatches","ViewTotp","show","hide","activate","desactivate","el","display","hash","unbind"],"mappings":"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","sourcesContent":["/* --- chat --- */\nimport {unsubAll} from '../chat/index'\nimport {personnalchannel} from '../chat/persochannel_channel'\nimport {subscGuild} from '../channels/guild_channel'\n\n/* ------------ */\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};‘:“\\\\|,.<>\\/?~]/;\n\nlet USER = {}; /* namespace */\n\nUSER.Model = Backbone.Model.extend({\n\turl: function() {\n\t\treturn \"/user\";\n\t}\n});\nUSER.CollectionFriends = Backbone.Collection.extend({\n\turl: function() {\n\t\treturn \"/user/friends\";\n\t}\n});\nUSER.CollectionMatches = Backbone.Collection.extend({\n\tcomparator: \"id\",\n\turl: function() {\n\t\treturn \"/user/matches\";\n\t}\n});\n\nUSER.model = new USER.Model();\nUSER.friends = new USER.CollectionFriends();\nUSER.matches = new USER.CollectionMatches();\n\nUSER.ViewAvatar = Backbone.View.extend({\n\tevents: {\n\t\t\"click input[type='submit']\": \"reload\"\n\t},\n\treload: function() {\n\t\twindow.location.reload(true);\n\t}\n});\n\nUSER.ViewName = Backbone.View.extend({\n\tevents: {\n\t\t\"dblclick label\": \"edit\",\n\t\t\"keypress input\": \"save\",\n\t},\n\tinitialize: function() {\n\t\tthis.template = _.template(_.unescape(this.$el.html()));\n\t\tthis.$el.html(this.template(this.model.attributes));\n\t},\n\tedit: function(event) {\n\t\t$(event.currentTarget).html(\"Username: \");\n\t\tthis.$el.children(\"input\").val(this.model.get(\"username\"));\n\t\tthis.$el.children(\"input\").attr(\"class\", \"show\");\n\t},\n\tsave: function(event) {\n\t\tif (event.which == global.ENTER_KEY) {\n\t\t\tlet username = this.$el.children(\"input\").val();\n\t\t\tif (username != \"\" && !format.test(username)) {\n\t\t\t\tthis.model.save({ username: username },\n\t\t\t\t\t\t\t\t{ patch: true,\n\t\t\t\t\t\t\t\t  wait: true,\n\t\t\t\t\t\t\t\t  headers: { \"X-CSRF-Token\": global.CSRF() } });\n\t\t\t}\n\t\t}\n\t}\n});\n\nUSER.ViewInfo = Backbone.View.extend({\n\tevents: {\n\t\t\"click #infoAdmin\": \"admin\",\n\t\t\"click #infoMatch\": \"match\"\n\t},\n\tinitialize: function() {\n\t\tthis.template = _.template(_.unescape(this.$el.html()));\n\t\tthis.$el.html(this.template(this.model.attributes));\n\t},\n\tadmin: function(event) {\n\t\tlet value;\n\t\tif ($(event.currentTarget).val() == \"false\")\n\t\t\tvalue = true;\n\t\telse\n\t\t\tvalue = false;\n\t\tthis.model.save({ admin: value },\n\t\t\t\t\t\t{ patch: true,\n\t\t\t\t\t\t  wait: true,\n\t\t\t\t\t\t  headers: { \"X-CSRF-Token\": global.CSRF() } });\n\t},\n\tmatch: function() {\n\t\tthis.model.save({ match: \"none\", status: \"online\" },\n\t\t\t\t\t\t{ patch: true,\n\t\t\t\t\t\t  wait: true,\n\t\t\t\t\t\t  headers: { \"X-CSRF-Token\": global.CSRF() } });\n\t}\n});\n\nUSER.ViewFriends = Backbone.View.extend({\n\tevents: {\n\t\t\"keypress input[type='text']\": \"add\",\n\t\t\"click input[type='button']\": \"remove\"\n\t},\n\ttemplate: _.template(\"<li>\" +\n\t\t\t\t\t\t \"<label><%- username %> [<%- status %>]</label>\" +\n\t\t\t\t\t\t \"<input data-name=<%- userid %> type='button'>\" +\n\t\t\t\t\t\t \"</li>\"),\n\tinitialize: function() {\n\t\tthis.collection.on(\"sync\", this.render, this);\n\t\tthis.collection.fetch();\n\t},\n\trender: function() {\n\t\tthis.$(\"ul\").html(\"\");\n\t\tthis.collection.each(this.renderItem, this);\n\t},\n\trenderItem: function(item) {\n\t\tthis.$(\"ul\").append(this.template(item.attributes));\n\t},\n\tadd: function(event) {\n\t\tif (event.which == global.ENTER_KEY) {\n\t\t\tlet friend = $(event.currentTarget).val();\n\t\t\t$(event.currentTarget).val(\"\");\n\t\t\tthis.collection.fetch({ url: \"/user/friends/\" + friend + \"/add\" });\n\t\t}\n\t},\n\tremove: function(event) {\n\t\tlet friend = $(event.currentTarget).data(\"name\");\n\t\tthis.collection.fetch({ url: \"/user/friends/\" + friend + \"/remove\" });\n\t}\n});\n\nUSER.ViewMatches = Backbone.View.extend({\n\ttemplate: _.template(\"<li>\" +\n\t\t\t\t\t\t \"<%- matchType %>: <%- playerLeft %> vs <%- playerRight %>\" +\n\t\t\t\t\t\t \" [<%- scoreLeft %> - <%- scoreRight %>]\" +\n\t\t\t\t\t\t \"</li>\"),\n\tinitialize: function() {\n\t\tthis.collection.on(\"sync\", this.render, this);\n\t\tthis.collection.fetch();\n\t},\n\trender: function() {\n\t\tthis.$(\"ul\").html(\"\");\n\t\tthis.collection.each(this.renderItem, this);\n\t},\n\trenderItem: function(item) {\n\t\tthis.$(\"ul\").append(this.template(item.attributes));\n\t}\n});\n\nUSER.ViewTotp = Backbone.View.extend({\n\tevents: {\n\t\t\"click input[value='show']\": \"show\",\n\t\t\"click input[value='hide']\": \"hide\",\n\t\t\"click input[value='activate']\": \"activate\",\n\t\t\"click input[value='desactivate']\": \"desactivate\"\n\t},\n\tinitialize: function() {\n\t\tif (this.model.get(\"TFA?\") == true)\n\t\t\tthis.$(\"input[value='TFA?']\").val(\"desactivate\");\n\t\telse\n\t\tthis.$(\"input[value='TFA?']\").val(\"activate\");\n\t},\n\tshow: function(event) {\n\t\t$(event.currentTarget).val(\"hide\");\n\t\tthis.$(\"label\").html(this.model.get(\"otp_secret\"));\n\t\tthis.$(\"label\").attr(\"class\", \"show\");\n\t},\n\thide: function(event) {\n\t\t$(event.currentTarget).val(\"show\");\n\t\tthis.$(\"label\").html(\"\");\n\t\tthis.$(\"label\").attr(\"class\", \"hide\");\n\t},\n\tactivate: function(event) {\n\t\t$(event.currentTarget).val(\"desactivate\");\n\t\tthis.model.save({ \"TFA?\": true },\n\t\t\t\t\t\t{ patch: true, wait: true,\n\t\t\t\t\t\t  headers: { \"X-CSRF-Token\": global.CSRF() } });\n\t},\n\tdesactivate: function(event) {\n\t\t$(event.currentTarget).val(\"activate\");\n\t\tthis.model.save({ \"TFA?\": false },\n\t\t\t\t\t\t{ patch: true, wait: true,\n\t\t\t\t\t\t  headers: { \"X-CSRF-Token\": global.CSRF() } });\n\t}\n});\n\nUSER.View = Backbone.View.extend({\n\tel: \"#main\",\n\tinitialize: function() {\n\t\tUSER.model.on(\"sync\", this.render, this);\n\t\tUSER.model.fetch();\n\t},\n\trender: function() {\n\t\tthis.$el.html($(\"#userTemplate\").html());\n\n\t\tnew USER.ViewAvatar({ el: this.$(\"#userAvatar\"),\n\t\t\t\t\t\t\t  model: USER.model });\n\n\t\tnew USER.ViewName({ el: this.$(\"#userName\"),\n\t\t\t\t\t\t\tmodel: USER.model });\n\n\t\tnew USER.ViewInfo({ el: this.$(\"#userInfo\"),\n\t\t\t\t\t\t\tmodel: USER.model });\n\n\t\tnew USER.ViewFriends({ el: this.$(\"#userFriends\"),\n\t\t\t\t\t\t\t   collection: USER.friends });\n\n\t\tnew USER.ViewMatches({ el: this.$(\"#userMatches\"),\n\t\t\t\t\t\t\t   collection: USER.matches });\n\n\t\tnew USER.ViewTotp({ el: this.$(\"#userTotp\"),\n\t\t\t\t\t\t\tmodel: USER.model });\n\n\t\tif(USER.model.get('guild_id') && USER.model.get('G_anagram'))\n\t\t{\n\t\t\t$('#anagram').html('[' +USER.model.get('G_anagram') + ']');\n\t\t}\n\t\t$('#playerUsername').html(USER.model.get('username'));\n\t\tpersonnalchannel()\n\t\tsubscGuild()\n\n\t}\n});\n\nUSER.display = function() {\n\twindow.location.hash = \"#user\";\n\n\t/* --- chat --- */\n\tunsubAll();\n\tUSER.model.unbind() // i have add this to remove the multiple 'on' on the model user , don't know if it will cause problem to you\n\t\t\t\t\t\t// remove it if it make probleme\n\t/* ------------ */\n\n\tnew USER.View();\n};\n\n$(\"#nav input[value='User']\").on(\"click\", USER.display);\n\nexport default USER;\n"]},"metadata":{},"sourceType":"module"}