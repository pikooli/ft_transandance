{"ast":null,"code":"import { personnalchannel } from './persochannel_channel';\nimport { subscribeChatLobby } from './roomlobby_channel';\nimport { subscribe_to } from './chatlobby';\nimport { sendMessage } from './sendMessage';\nimport { popWindows, popChoise, popChoise2 } from '../popWindows/popWindows';\nimport { player } from '../nav/chat';\nvar muted = {};\nvar token;\nvar subchat;\nvar sublobby;\nvar roomname;\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\nexport function chatFunction() {\n  var anagram = $('#anagram').html();\n  token = document.getElementsByName('csrf-token')[0].content;\n  checkrefresh();\n  unsubAll();\n  if (!sublobby) sublobby = subscribeChatLobby();\n  getmuted();\n  $(\"#chatroom\").on('click', \"button\", function () {\n    var chatroom = this.id;\n    chatroom = chatroom.substring(4);\n\n    if ($('#chatname').html() != chatroom) {\n      subscribeToRoom(chatroom, player);\n    }\n  });\n  $('#submitNameChat').click(function () {\n    createChatroom();\n  });\n  $('#submitMessage').click(function () {\n    sendMessage(player, token, roomname, anagram);\n  });\n  $('input').on('keydown', function (data) {\n    if (data.keyCode === 13) {\n      if (this.id === 'password') $('#submitNameChat').trigger('click');else $('#submit' + this.id).trigger('click');\n    }\n  });\n}\n;\n\nfunction subscribeToRoom(room) {\n  // send a ajax to see if we are ban from this channel or not\n  var pass = $('#password' + room);\n  $.ajax({\n    url: 'roomchat/join',\n    data: {\n      roomname: room,\n      speudo: player,\n      password: pass.val(),\n      authenticity_token: token\n    },\n    type: 'GET',\n    success: function success(data) {\n      if (data.erros) popWindows('you are ban from this room');else if (data.password) popWindows('bad password');else {\n        if (subchat) subchat.unsubscribe();\n        subchat = subscribe_to(data.room, player);\n        roomname = data.room;\n      }\n      pass.val('');\n    }\n  });\n}\n\nfunction getmuted() {\n  $.ajax({\n    url: 'personal/muted',\n    data: {\n      speudo: player\n    },\n    type: 'GET',\n    success: function success(data) {\n      jQuery.each(data, function (k, v) {\n        muted[v.speudo] = true;\n      });\n    }\n  });\n}\n\nexport function unsubchat() {\n  if (subchat) subchat.unsubscribe();\n}\nexport function unsubAll() {\n  unsubchat();\n}\nexport function addmuted(speudo) {\n  muted[speudo] = true;\n}\nexport function unmute(speudo) {\n  muted[speudo] = false;\n}\nexport function ismuted(speudo) {\n  if (muted[speudo] === true) return true;else return false;\n}\nexport function unsub() {\n  subchat.unsubscribe();\n  subchat = null;\n}\n\nfunction createChatroom() {\n  var pass = $('#password').val();\n  var content = $('#NameChat').val();\n\n  if (content) {\n    if (!format.test(content) && !format.test(pass)) {\n      sendAjax('chatroom/create', {\n        speudo: player,\n        password: pass,\n        roomname: content,\n        authenticity_token: token\n      }, \"POST\");\n      $('#NameChat').val('');\n      if (pass) $('#password').val('');\n    } else popWindows(\"bad caractere in namechat or password\");\n  }\n}\n\nfunction sendAjax(urlSend, dataSend) {\n  var typeSend = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'GET';\n  $.ajax({\n    url: urlSend,\n    data: dataSend,\n    type: typeSend\n  });\n}\n\nfunction checkrefresh() {\n  if (performance.navigation.type == 1) {\n    unsubAll();\n  } else {}\n}","map":{"version":3,"sources":["/pong_rails/app/javascript/chat/index.js"],"names":["personnalchannel","subscribeChatLobby","subscribe_to","sendMessage","popWindows","popChoise","popChoise2","player","muted","token","subchat","sublobby","roomname","format","chatFunction","anagram","$","html","document","getElementsByName","content","checkrefresh","unsubAll","getmuted","on","chatroom","id","substring","subscribeToRoom","click","createChatroom","data","keyCode","trigger","room","pass","ajax","url","speudo","password","val","authenticity_token","type","success","erros","unsubscribe","jQuery","each","k","v","unsubchat","addmuted","unmute","ismuted","unsub","test","sendAjax","urlSend","dataSend","typeSend","performance","navigation"],"mappings":"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","sourcesContent":["import {personnalchannel} from './persochannel_channel'\nimport {subscribeChatLobby} from './roomlobby_channel'\nimport {subscribe_to} from './chatlobby'\nimport {sendMessage} from './sendMessage'\nimport {popWindows,popChoise, popChoise2} from '../popWindows/popWindows'\n\nimport {player} from '../nav/chat'\nvar muted = {};\n\nvar token;\nvar subchat;\nvar sublobby;\nvar roomname;\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\n\nexport function chatFunction(){\n\t\n\tvar anagram = $('#anagram').html();\n\n\ttoken = document.getElementsByName('csrf-token')[0].content;\n\tcheckrefresh()\n\tunsubAll();\n\n\tif (!sublobby)\n\t\tsublobby = subscribeChatLobby();\n\tgetmuted();\n\t$(\"#chatroom\").on('click',\"button\", function(){\n\t\tlet chatroom = this.id\n\t\tchatroom = chatroom.substring(4);\n\n\t\tif ($('#chatname').html() != chatroom ){\n\t\t\tsubscribeToRoom(chatroom , player);\n\t\t}\n\t})\n\n\t$('#submitNameChat').click(function(){createChatroom()})\n\n\t$('#submitMessage').click(function() {sendMessage(player, token, roomname, anagram)})\n\n\t$('input').on('keydown', function(data){\n\n\t\tif (data.keyCode === 13){\n\t\t\tif (this.id === 'password')\n\t\t\t\t$('#submitNameChat').trigger('click')\n\t\t\telse\n\t\t\t\t$('#submit' + this.id ).trigger('click')\n\t\t}\n\t});\n\n};\n\n\nfunction subscribeToRoom(room){\n\n// send a ajax to see if we are ban from this channel or not\n\n\tvar pass = $('#password'+ room)\n\t$.ajax({\n\t\turl: 'roomchat/join',\n\t\tdata: {\n\t\t\troomname: room,\n\t\t\tspeudo: player,\n\t\t\tpassword: pass.val(),\n\t\t\tauthenticity_token: token\n\t\t\t},\n\t\ttype: 'GET',\n\t\tsuccess: function(data){\n\t\t\t\tif (data.erros)\n\t\t\t\tpopWindows('you are ban from this room')\n\t\t\t\telse if (data.password)\n\t\t\t\tpopWindows('bad password')\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (subchat)\n\t\t\t\t\t\tsubchat.unsubscribe();\n\t\t\t\t\tsubchat = subscribe_to(data.room, player)\n\t\t\t\t\troomname = data.room;\n\t\t\t\t}\n\t\t\t\tpass.val('')\n\t\t}\n\t})\n}\n\nfunction getmuted(){\n\t$.ajax({\n\t\turl: 'personal/muted',\n\t\tdata: {speudo: player},\n\t\ttype: 'GET',\n\t\tsuccess: function(data){\n\t\t\tjQuery.each(data,function(k,v){\n\t\t\t\tmuted[v.speudo] = true;\n\t\t\t})\n\t\t}\n\t})\n}\n\nexport function unsubchat(){\n\tif (subchat)\n\t\tsubchat.unsubscribe();\n}\n\nexport function unsubAll(){\n\tunsubchat();\n}\n\nexport function addmuted(speudo){\n\tmuted[speudo] = true;\n}\n\nexport function unmute(speudo){\n\tmuted[speudo] = false;\n}\n\nexport function ismuted(speudo){\n\tif (muted[speudo] === true)\n\t\treturn true\n\telse\n\t\treturn false\n}\n\nexport function unsub(){\n\tsubchat.unsubscribe();\n\tsubchat = null;\n}\n\nfunction createChatroom(){\n\n\tvar pass =  $('#password').val();\n\tvar content = $('#NameChat').val()\n\n\tif (content) {\n\t\tif (!format.test(content) && !format.test(pass)){\n\t\t\tsendAjax('chatroom/create',\n\t\t\t\t{\n\t\t\t\t\tspeudo: player,\n\t\t\t\t\tpassword: pass,\n\t\t\t\t\troomname: content,\n\t\t\t\t\tauthenticity_token: token\n\t\t\t\t}\n\t\t\t\t, \"POST\");\n\t\t$('#NameChat').val('');\n\t\tif (pass)\n\t\t\t$('#password').val('')\n\t\t}\n\t\telse\n\t\tpopWindows(\"bad caractere in namechat or password\")\n\t}\n}\n\nfunction sendAjax(urlSend, dataSend, typeSend='GET'){\n\t$.ajax({\n\t\turl: urlSend,\n\t\tdata: dataSend,\n\t\ttype: typeSend\n\t})\n\n}\n\nfunction checkrefresh(){\n\n\t\tif (performance.navigation.type == 1) {\n\t\t\tunsubAll()\n\t\t} else {\n\t\t}\n}\n\n"]},"metadata":{},"sourceType":"module"}