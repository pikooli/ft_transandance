{"ast":null,"code":"import USER from \"./user\";\nimport { Guildwar } from \"../Guildwars/guildwars\";\nimport { subscGuild } from '../channels/guild_channel';\nimport { popWindows, popChoise, pop404 } from '../popWindows/popWindows';\nimport { txt404, cat404 } from '../Useless/funscript';\n/* --- chat --- */\n\nimport { unsubAll } from '../chat/index';\n/* ------------ */\n\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\nvar GUILD = {};\nGUILD.Model = Backbone.Model.extend({\n  url: function url() {\n    return \"/guild\";\n  }\n});\nGUILD.Collection = Backbone.Collection.extend({\n  model: GUILD.Model,\n  comparator: function comparator(a, b) {\n    return a.get(\"points\") < b.get(\"points\") ? 1 : -1;\n  },\n  url: function url() {\n    return \"/guilds\";\n  }\n});\nGUILD.CollectionWar = Backbone.Collection.extend({\n  url: function url() {\n    return \"/guildswars/history\";\n  }\n});\nGUILD.model = new GUILD.Model();\nGUILD.collection = new GUILD.Collection();\nGUILD.collectionWar = new GUILD.CollectionWar();\nGUILD.ViewInfo = Backbone.View.extend({\n  initialize: function initialize() {\n    this.template = _.template(\"<h2>Your Guild ヽ(´▽`)/</h2>\" + \"<h2 id='guildnameplace'><%- guildname %></h2>\" + \"<h4> Owner : <%- owner %> </h4>\" + \"<input type='text' id='newOfficer' placeholder='username'/>\" + \"<button id='buttonOfficer'>Promote Officier</button>\" + \"<h4> Officier : </h4>\" + \"<ul id='officer'></ul>\"), this.model.on(\"sync\", this.render, this);\n    this.model.fetch();\n  },\n  render: function render() {\n    if (this.model.get(\"error\") == true) {\n      this.$el.html(\"<h2>you have no guild</h2>\");\n    } else {\n      this.$el.html(this.template(this.model.attributes));\n    }\n  }\n});\nGUILD.OfficerCollection = Backbone.Collection.extend({\n  url: '/officer'\n});\nGUILD.officerCollection = new GUILD.OfficerCollection();\nGUILD.ViewOfficier = Backbone.View.extend({\n  collection: GUILD.officerCollection,\n  model: GUILD.model,\n  initialize: function initialize() {\n    this.model.on(\"sync\", this.getOfficer, this);\n    this.collection.on('sync', this.render, this);\n  },\n  events: {\n    \"click li button\": \"removeOfficer\",\n    \"click #buttonOfficer\": \"createOfficier\",\n    \"keypress #newOfficer\": 'checkinput'\n  },\n  checkinput: function checkinput(e) {\n    if (e.which === 13) this.createOfficier();\n  },\n  createOfficier: function createOfficier() {\n    var input = $('#newOfficer');\n    if (format.test(input.val())) popWindows('incorrect format');else if (input.val()) {\n      $.ajax({\n        url: '/guilds/checkOfficier',\n        data: {\n          username: input.val(),\n          idguild: GUILD.model.get('id'),\n          sender: $('#playerUsername').html()\n        },\n        type: \"get\",\n        success: function success(data) {\n          var input = $('#newOfficer');\n\n          if (!data.error) {\n            GUILD.officerCollection.create({\n              username: input.val(),\n              idguild: GUILD.model.get('id'),\n              sender: $('#playerUsername').html()\n            }, {\n              wait: true,\n              headers: {\n                \"X-CSRF-Token\": global.CSRF()\n              }\n            });\n            popWindows('officier promoted');\n          } else popWindows(data.error);\n\n          input.val('');\n        }\n      });\n    }\n  },\n  removeOfficer: function removeOfficer(event) {\n    var target = event.currentTarget.id;\n    target = target.substring(4, target.size);\n    $.ajax({\n      url: 'removeOfficer',\n      type: 'GET',\n      data: {\n        owner: $('#playerUsername').html(),\n        target: target,\n        guild_id: GUILD.model.id\n      },\n      success: function success(data) {\n        if (!data.error) {\n          GUILD.officerCollection.fetch({\n            data: $.param({\n              id: GUILD.model.get('id')\n            })\n          });\n        } else popWindows(data.error);\n      }\n    });\n  },\n  getOfficer: function getOfficer() {\n    this.collection.fetch({\n      data: $.param({\n        id: this.model.get('id')\n      })\n    });\n  },\n  render: function render() {\n    var elem = $('#officer');\n    elem.html('');\n    this.collection.each(function (username) {\n      elem.append('<li> ' + username.get(\"username\") + '<button type=\"button\" id=\"offi' + username.get(\"username\") + '\">X</button></li>');\n    });\n  }\n});\nGUILD.ViewCreate = Backbone.View.extend({\n  events: {\n    \"click input[type='button']\": \"create\",\n    \"keypress input[type='text']\": \"check\"\n  },\n  check: function check(e) {\n    if (e.which === 13) this.create();\n  },\n  create: function create() {\n    var input = this.$el.children(\"input[type='text']\");\n    if (format.test(input.val())) popWindows('incorrect format');else if (input.val()) {\n      $.ajax({\n        url: '/guilds/check',\n        data: {\n          guildname: input.val(),\n          anagram: input.val().substring(0, 5),\n          owner: USER.model.get(\"username\")\n        },\n        type: \"get\",\n        success: function success(data) {\n          var input = $('#makeGuild');\n\n          if (!data.error) {\n            GUILD.collection.create({\n              guildname: input.val(),\n              anagram: input.val().substring(0, 5),\n              owner: USER.model.get(\"username\")\n            }, {\n              wait: true,\n              headers: {\n                \"X-CSRF-Token\": global.CSRF()\n              }\n            });\n            popWindows('guild create');\n          } else popWindows(data.error);\n\n          input.val(\"\");\n        }\n      });\n    }\n  }\n});\nGUILD.ViewJoin = Backbone.View.extend({\n  template: _.template(\"<li>\" + \"<%- guildname %> [<%- points %>]\" + \"<button data-guild=<%- guildname %>>join</button></li>\"),\n  events: {\n    \"click button\": \"join\",\n    \"dblclick button\": \"join\"\n  },\n  initialize: function initialize() {\n    this.collection.on(\"sync\", this.render, this);\n    this.collection.fetch();\n  },\n  render: function render() {\n    this.$(\"ol\").html(\"\");\n    this.collection.each(this.renderItem, this);\n  },\n  renderItem: function renderItem(item) {\n    this.$(\"ol\").append(this.template(item.attributes));\n  },\n  join: function join(event) {\n    var guild = $(event.currentTarget).data(\"guild\");\n    this.model.fetch({\n      url: \"/guild/\" + guild + \"/edit\"\n    });\n    $('#anagram').html('[' + guild.substring(0, 5) + ']');\n    subscGuild();\n  }\n});\nGUILD.View = Backbone.View.extend({\n  el: \"#main\",\n  initialize: function initialize() {\n    this.$el.html($(\"#guildTemplate\").html());\n    new GUILD.ViewInfo({\n      el: this.$(\"#guildInfo\"),\n      model: this.model\n    });\n    new GUILD.ViewCreate({\n      el: this.$(\"#guildCreate\"),\n      collection: this.collection\n    });\n    new GUILD.ViewJoin({\n      el: this.$(\"#guildJoin\"),\n      model: this.model,\n      collection: this.collection\n    });\n    new GUILD.ViewRanking({\n      el: this.$(\"#guildRanking\"),\n      model: this.model,\n      collection: this.collection\n    });\n    new GUILD.ViewOfficier({\n      el: this.$('#guildInfo')\n    });\n    Guildwar(GUILD.model);\n  },\n  events: {\n    \"click #MyGuild\": \"getGuild\"\n  },\n  getGuild: function getGuild() {\n    GUILD.officerCollection.fetch({\n      data: $.param({\n        id: GUILD.model.get('id')\n      })\n    });\n  }\n}); //-------------------------------------------------\n\nGUILD.ViewRanking = Backbone.View.extend({\n  template: _.template(\"<li>\" + \"[<%- guildname %>] points : <%- points %>\"),\n  initialize: function initialize() {\n    this.collection.on(\"sync\", this.render, this);\n  },\n  render: function render() {\n    this.$(\"ol\").html(\"\");\n    this.collection.each(this.renderItem, this);\n  },\n  renderItem: function renderItem(item) {\n    this.$(\"ol\").append(this.template(item.attributes));\n  }\n}); // ------------------------------------------------------------------------ history\n\nGUILD.ViewHistory = Backbone.View.extend({\n  collection: GUILD.collectionWar,\n  template: _.template(\"<input id='seachHistoy' placeholder='name of the guild'>\" + \"<button id='searchhistory'>search</button>\" + \"<table id='searchresult'>\" + \"</table>\"),\n  templateOne: _.template(\"<tr><th><%- id %></th><th><%- start %></th><th><%- end %></th><th> <%- guildname_1 %> </th> <th><%- point_1 %></th> \" + \"<th><%- guildname_2 %></th> <th><%- point_2 %></th>\" + \"<th><%- pointbet %> </th></tr>\"),\n  initialize: function initialize() {\n    this.$el.html(this.template());\n    this.collection.on('sync', this.render, this);\n  },\n  events: {\n    \"click #searchhistory\": \"searchhistory\",\n    'keypress #seachHistoy': 'checkinput'\n  },\n  checkinput: function checkinput(e) {\n    if (e.which === 13) this.searchhistory();\n  },\n  searchhistory: function searchhistory() {\n    if ($('#seachHistoy').val()) if (format.test($('#seachHistoy').val())) popWindows('incorrect format');else this.collection.fetch({\n      data: $.param({\n        guildname: $('#seachHistoy').val()\n      })\n    });\n    $('#seachHistoy').val('');\n  },\n  render: function render() {\n    if (!this.collection.length) $('#searchresult').html(cat404());else {\n      $('#searchresult').html(\"<tr> <th> Match ID</th><th> Start on </th><th> end </th> <th>Guild 1</th><th> Score Guild 1 </th> <th>Guild 2</th><th> Score Guild 2 </th> <th> Point bet</th> </tr> \");\n      this.collection.each(this.renderthis, this);\n      this.collection.reset();\n    }\n  },\n  renderthis: function renderthis(item) {\n    var a = item.attributes;\n\n    for (var key in a) {\n      this.renderOne(a[key]);\n    }\n  },\n  renderOne: function renderOne(item) {\n    $('#searchresult').append(this.templateOne(item));\n  }\n}); // ---------------------------------------------------------------------------\n\nGUILD.ViewMyGuild = Backbone.View.extend({\n  el: '#GuildMenu',\n  events: {\n    'click #MyGuild': 'showMyGuild',\n    'click #CreateGuild': 'showCreateGuild',\n    'click #JoinGuild': 'showJoinGuild',\n    'click #GuildRank': 'showGuildRank',\n    'click #ProposeWars': 'showProposeWars',\n    'click #GuildWars': 'showguildWars',\n    'click #GuildHistory': 'showguildHistory'\n  },\n  showMyGuild: function showMyGuild() {\n    showpartiel('guildInfo');\n  },\n  showCreateGuild: function showCreateGuild() {\n    showpartiel('guildCreate');\n  },\n  showJoinGuild: function showJoinGuild() {\n    GUILD.collection.fetch();\n    showpartiel('guildJoin');\n  },\n  showGuildRank: function showGuildRank() {\n    GUILD.collection.fetch();\n    showpartiel('guildRanking');\n  },\n  showProposeWars: function showProposeWars() {\n    showpartiel('proposeWars');\n  },\n  showguildWars: function showguildWars() {\n    showpartiel('guildWars');\n  },\n  showguildHistory: function showguildHistory() {\n    showpartiel('guildHistory');\n    $('#seachHistoy').focus();\n  }\n}); // ----------------------------------------------------------\n\nfunction removeOn(element) {\n  element.unbind();\n}\n\nfunction showpartiel(show) {\n  $('#GuildMain div').hide();\n  $('#' + show).show();\n}\n\nGUILD.display = function () {\n  window.location.hash = \"#guild\";\n  removeOn(GUILD.model);\n  removeOn(GUILD.collection);\n  removeOn(GUILD.collectionWar);\n  /* --- chat --- */\n\n  unsubAll();\n  /* ------------ */\n\n  new GUILD.View({\n    model: GUILD.model,\n    collection: GUILD.collection\n  });\n  new GUILD.ViewMyGuild();\n  new GUILD.ViewHistory({\n    el: '#guildHistory'\n  });\n  subscGuild();\n};\n\n$(\"#nav input[value='Guild']\").on(\"click\", GUILD.display);\nexport default GUILD;","map":{"version":3,"sources":["/pong_rails/app/javascript/nav/guild.js"],"names":["USER","Guildwar","subscGuild","popWindows","popChoise","pop404","txt404","cat404","unsubAll","format","GUILD","Model","Backbone","extend","url","Collection","model","comparator","a","b","get","CollectionWar","collection","collectionWar","ViewInfo","View","initialize","template","_","on","render","fetch","$el","html","attributes","OfficerCollection","officerCollection","ViewOfficier","getOfficer","events","checkinput","e","which","createOfficier","input","$","test","val","ajax","data","username","idguild","sender","type","success","error","create","wait","headers","global","CSRF","removeOfficer","event","target","currentTarget","id","substring","size","owner","guild_id","param","elem","each","append","ViewCreate","check","children","guildname","anagram","ViewJoin","renderItem","item","join","guild","el","ViewRanking","getGuild","ViewHistory","templateOne","searchhistory","length","renderthis","reset","key","renderOne","ViewMyGuild","showMyGuild","showpartiel","showCreateGuild","showJoinGuild","showGuildRank","showProposeWars","showguildWars","showguildHistory","focus","removeOn","element","unbind","show","hide","display","window","location","hash"],"mappings":"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","sourcesContent":["import USER from \"./user\";\nimport {Guildwar} from \"../Guildwars/guildwars\"\nimport {subscGuild} from '../channels/guild_channel'\nimport {popWindows,popChoise, pop404} from '../popWindows/popWindows'\nimport {txt404,cat404} from  '../Useless/funscript'\n\n/* --- chat --- */\nimport {unsubAll} from '../chat/index'\n/* ------------ */\nvar format = /[ `!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\n\nlet GUILD = {};\n\nGUILD.Model = Backbone.Model.extend({\n\turl: function() {\n\t\treturn \"/guild\";\n\t}\n});\n\nGUILD.Collection = Backbone.Collection.extend({\n\tmodel: GUILD.Model,\n\tcomparator: function(a, b) {\n\t\treturn (a.get(\"points\") < b.get(\"points\") ? 1 : -1);\n\t},\n\turl: function() {\n\t\treturn \"/guilds\";\n\t}\n});\n\nGUILD.CollectionWar = Backbone.Collection.extend({\n\turl: function() {\n\t\treturn \"/guildswars/history\";\n\t}\n});\n\n\nGUILD.model = new GUILD.Model();\nGUILD.collection = new GUILD.Collection();\nGUILD.collectionWar = new GUILD.CollectionWar();\n\n\nGUILD.ViewInfo = Backbone.View.extend({\n\tinitialize: function() {\n\t\tthis.template = _.template(\n\t\t\t\t\"<h2>Your Guild ヽ(´▽`)/</h2>\" +\n\t\t\t\t\"<h2 id='guildnameplace'><%- guildname %></h2>\" +\n\t\t\t\t\"<h4> Owner : <%- owner %> </h4>\" +\n\t\t\t\t\"<input type='text' id='newOfficer' placeholder='username'/>\" +\n\t\t\t\t\"<button id='buttonOfficer'>Promote Officier</button>\" +\n\t\t\t\t\"<h4> Officier : </h4>\" +\n\t\t\t\t\"<ul id='officer'></ul>\"\n\t\t),\n\t\tthis.model.on(\"sync\", this.render, this);\n\t\tthis.model.fetch();\n\t},\n\trender: function() {\n\t\tif (this.model.get(\"error\") == true) {\n\t\t\tthis.$el.html(\"<h2>you have no guild</h2>\");\n\t\t}\n\t\telse {\n\t\t\tthis.$el.html(this.template(this.model.attributes));\n\t\t}\n\t}\n});\n\n\nGUILD.OfficerCollection = Backbone.Collection.extend({\n\turl: '/officer'\n})\n\nGUILD.officerCollection = new GUILD.OfficerCollection();\n\nGUILD.ViewOfficier = Backbone.View.extend({\n\tcollection : GUILD.officerCollection,\n\tmodel: GUILD.model,\n\tinitialize: function(){\n\t\tthis.model.on(\"sync\", this.getOfficer, this)\n\t\tthis.collection.on('sync', this.render, this)\n\t},\n\tevents: {\n\t\t\"click li button\" : \"removeOfficer\",\n\t\t\"click #buttonOfficer\" : \"createOfficier\",\n\t\t\"keypress #newOfficer\" : 'checkinput'\n\t},\n\tcheckinput: function(e){\n\t\tif (e.which === 13)\n\t\t\tthis.createOfficier();\n\t},\n\tcreateOfficier: function(){\n\t\tlet input = $('#newOfficer')\n\n\t\tif (format.test(input.val()))\n\t\t\tpopWindows('incorrect format')\n\n\t\telse if (input.val()){\n\t\t\t$.ajax({\n\t\t\t\turl: '/guilds/checkOfficier',\n\t\t\t\tdata: {\n\t\t\t\t\tusername: input.val(),\n\t\t\t\t\tidguild: GUILD.model.get('id'),\n\t\t\t\t\tsender: $('#playerUsername').html()\n\t\t\t\t},\n\t\t\t\ttype: \"get\",\n\n\t\t\t\tsuccess: function(data){\n\n\t\t\t\t\tlet input = $('#newOfficer')\n\n\t\t\t\t\tif(!data.error){\n\t\t\t\t\t\tGUILD.officerCollection.create(\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tusername: input.val(),\n\t\t\t\t\t\t\t\t\t\t\t\tidguild: GUILD.model.get('id'),\n\t\t\t\t\t\t\t\t\t\t\t\tsender: $('#playerUsername').html()\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\twait: true,\n\t\t\t\t\t\t\t\t\t\t\t\theaders: { \"X-CSRF-Token\": global.CSRF() }\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t\tpopWindows('officier promoted')\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tpopWindows(data.error)\n\t\t\t\t\tinput.val('')\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tremoveOfficer: function(event){\n\t\tvar target = event.currentTarget.id\n\t\ttarget = target.substring(4,target.size)\n\n\t\t$.ajax({\n\t\t\turl: 'removeOfficer',\n\t\t\ttype: 'GET',\n\t\t\tdata:{\n\t\t\t\towner: $('#playerUsername').html(),\n\t\t\t\ttarget: target,\n\t\t\t\tguild_id: GUILD.model.id,\n\t\t\t},\n\t\t\tsuccess: function(data){\n\t\t\t\tif (!data.error){\n\t\t\t\t\tGUILD.officerCollection.fetch({data: $.param({id: GUILD.model.get('id')})});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tpopWindows(data.error)\n\t\t\t}\n\t\t})\n\t},\n\tgetOfficer: function(){\n\t\tthis.collection.fetch({data: $.param({id: this.model.get('id')})});\n\t},\n\trender: function(){\n\n\t\tlet elem = $('#officer')\n\t\telem.html('')\n\t\tthis.collection.each(function(username){\n\n\t\t\telem.append('<li> ' + username.get(\"username\") + '<button type=\"button\" id=\"offi' + username.get(\"username\") +'\">X</button></li>')\n\t\t})\n\t}\n})\n\n\nGUILD.ViewCreate = Backbone.View.extend({\n\tevents: {\n\t\t\"click input[type='button']\": \"create\",\n\t\t\"keypress input[type='text']\": \"check\"\n\t},\n\tcheck: function(e){\n\t\tif (e.which === 13)\n\t\t\tthis.create();\n\t},\n\tcreate: function() {\n\t\tvar input = this.$el.children(\"input[type='text']\");\n\n\t\tif (format.test(input.val()))\n\t\t\tpopWindows('incorrect format')\n\t\telse if (input.val()){\n\t\t\t$.ajax({\n\t\t\t\turl: '/guilds/check',\n\t\t\t\tdata: {\tguildname: input.val(),\n\t\t\t\t\t\tanagram: input.val().substring(0, 5),\n\t\t\t\t\t\towner: USER.model.get(\"username\")\n\t\t\t\t},\n\t\t\t\ttype: \"get\",\n\t\t\t\tsuccess: function(data){\n\n\t\t\t\t\tvar input = $('#makeGuild');\n\t\t\t\t\tif (!data.error){\n\t\t\t\t\t\tGUILD.collection.create({ guildname: input.val(),\n\t\t\t\t\t\t\t\t\t\t\tanagram: input.val().substring(0, 5),\n\t\t\t\t\t\t\t\t\t\t\towner: USER.model.get(\"username\")\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{ wait: true,\n\t\t\t\t\t\t\t\t\t\theaders: { \"X-CSRF-Token\": global.CSRF() } });\n\t\t\t\t\t\tpopWindows('guild create')\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tpopWindows(data.error)\n\t\t\t\t\tinput.val(\"\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n});\n\nGUILD.ViewJoin = Backbone.View.extend({\n\ttemplate: _.template(\"<li>\" +\n\t\t\t\t\t\t  \"<%- guildname %> [<%- points %>]\" +\n\t\t\t\t\t\t  \"<button data-guild=<%- guildname %>>join</button></li>\"),\n\tevents: {\n\t\t\"click button\" : \"join\",\n\t\t\"dblclick button\" : \"join\"\n\t},\n\tinitialize: function() {\n\t\tthis.collection.on(\"sync\", this.render, this);\n\t\tthis.collection.fetch();\n\t},\n\trender: function() {\n\t\tthis.$(\"ol\").html(\"\");\n\t\tthis.collection.each(this.renderItem, this);\n\t},\n\trenderItem: function(item) {\n\t\tthis.$(\"ol\").append(this.template(item.attributes));\n\t},\n\tjoin: function(event) {\n\t\tlet guild = $(event.currentTarget).data(\"guild\")\n\n\t\tthis.model.fetch({ url: \"/guild/\" +\n\t\t\t\t\t\t\t\tguild +\n\t\t\t\t\t\t\t\t\"/edit\" });\n\t\t$('#anagram').html('[' + guild.substring(0, 5) + ']');\n\t\tsubscGuild();\n\t}\n});\n\nGUILD.View = Backbone.View.extend({\n\tel: \"#main\",\n\tinitialize: function() {\n\t\tthis.$el.html($(\"#guildTemplate\").html());\n\n\t\tnew GUILD.ViewInfo({ el: this.$(\"#guildInfo\"),\n\t\t\t\t\t\t\t model: this.model });\n\n\t\tnew GUILD.ViewCreate({ el: this.$(\"#guildCreate\"),\n\t\t\t\t\t\t\t   collection: this.collection });\n\n\t\tnew GUILD.ViewJoin({ el: this.$(\"#guildJoin\"),\n\t\t\t\t\t\t\t model: this.model,\n\t\t\t\t\t\t\t collection: this.collection });\n\t\tnew GUILD.ViewRanking({el: this.$(\"#guildRanking\"),\n\t\t\t\t\t\t\t\tmodel: this.model,\n\t\t\t\t\t\t\t\tcollection: this.collection })\n\t\tnew GUILD.ViewOfficier({el: this.$('#guildInfo')});\n\n\t\tGuildwar(GUILD.model);\n\t},\n\tevents:{\n\t\t\"click #MyGuild\": \"getGuild\"\n\t},\n\tgetGuild: function(){\n\t\tGUILD.officerCollection.fetch({data: $.param({id: GUILD.model.get('id')})})\n\t}\n});\n\n//-------------------------------------------------\n\nGUILD.ViewRanking = Backbone.View.extend({\n\ttemplate: _.template(\"<li>\" +\n\t\t\t\t\t\t  \"[<%- guildname %>] points : <%- points %>\"\n\t),\n\tinitialize: function() {\n\t\tthis.collection.on(\"sync\", this.render, this);\n\t},\n\trender: function() {\n\t\tthis.$(\"ol\").html(\"\");\n\t\tthis.collection.each(this.renderItem, this);\n\t},\n\trenderItem: function(item) {\n\t\tthis.$(\"ol\").append(this.template(item.attributes));\n\t},\n});\n// ------------------------------------------------------------------------ history\n\nGUILD.ViewHistory = Backbone.View.extend({\n\n\tcollection: GUILD.collectionWar,\n\ttemplate: _.template(\t\"<input id='seachHistoy' placeholder='name of the guild'>\" +\n\t\t\t\t\t\t\t\"<button id='searchhistory'>search</button>\" +\n\t\t\t\t\t\t\t\"<table id='searchresult'>\" +\n\t\t\t\t\t\t\t\"</table>\"\n\t),\n\ttemplateOne: _.template(\t\"<tr><th><%- id %></th><th><%- start %></th><th><%- end %></th><th> <%- guildname_1 %> </th> <th><%- point_1 %></th> \"+\n\t\t\t\t\t\t\t\t\"<th><%- guildname_2 %></th> <th><%- point_2 %></th>\" +\n\t\t\t\t\t\t\t\t\"<th><%- pointbet %> </th></tr>\"\n\t),\n\tinitialize: function() {\n\t\tthis.$el.html(this.template())\n\t\tthis.collection.on('sync', this.render, this)\n\t},\n\tevents:\n\t{\n\t\t\"click #searchhistory\": \"searchhistory\",\n\t\t'keypress #seachHistoy' : 'checkinput'\n\t},\n\tcheckinput: function(e){\n\t\t\n\t\tif (e.which === 13)\n\t\t\tthis.searchhistory()\n\t},\n\tsearchhistory: function(){\n\n\t\tif ($('#seachHistoy').val())\n\t\t\tif (format.test($('#seachHistoy').val()))\n\t\t\t\tpopWindows('incorrect format')\n\t\t\telse\n\t\t\t\tthis.collection.fetch({data: $.param({guildname: $('#seachHistoy').val()})})\n\t\t\t$('#seachHistoy').val('')\n\t},\n\trender: function(){\n\t\tif (!this.collection.length)\n\t\t\t$('#searchresult').html(cat404())\n\t\telse{\n\t\t\t$('#searchresult').html(\"<tr> <th> Match ID</th><th> Start on </th><th> end </th> <th>Guild 1</th><th> Score Guild 1 </th> <th>Guild 2</th><th> Score Guild 2 </th> <th> Point bet</th> </tr> \")\n\t\t\tthis.collection.each(this.renderthis, this)\n\t\t\tthis.collection.reset()\n\t\t}\n\t},\n\trenderthis: function(item){\n\t\tvar  a = item.attributes\n\n\t\tfor (let key in a){\n\t\t\tthis.renderOne(a[key])\n\t\t}\n\t},\n\trenderOne: function(item){\n\t\t$('#searchresult').append(this.templateOne(item))\n\t}\n});\n\n\n\n\n// ---------------------------------------------------------------------------\n\nGUILD.ViewMyGuild = Backbone.View.extend({\n\tel: '#GuildMenu',\n\tevents: {\n\t\t'click #MyGuild' : 'showMyGuild',\n\t\t'click #CreateGuild' : 'showCreateGuild',\n\t\t'click #JoinGuild' : 'showJoinGuild',\n\t\t'click #GuildRank' : 'showGuildRank',\n\t\t'click #ProposeWars' : 'showProposeWars',\n\t\t'click #GuildWars' : 'showguildWars',\n\t\t'click #GuildHistory' : 'showguildHistory',\n\n\t},\n\tshowMyGuild: function(){\n\t\tshowpartiel('guildInfo');\n\t},\n\tshowCreateGuild: function(){\n\t\tshowpartiel('guildCreate');\n\t},\n\tshowJoinGuild: function(){\n\t\tGUILD.collection.fetch()\n\t\tshowpartiel('guildJoin');\n\t},\n\tshowGuildRank: function(){\n\t\tGUILD.collection.fetch()\n\t\tshowpartiel('guildRanking');\n\t},\n\tshowProposeWars: function(){\n\t\tshowpartiel('proposeWars');\n\t},\n\tshowguildWars: function(){\n\t\tshowpartiel('guildWars');\n\t},\n\tshowguildHistory: function(){\n\t\tshowpartiel('guildHistory');\n\t\t$('#seachHistoy').focus()\n\n\t},\n})\n\n// ----------------------------------------------------------\nfunction removeOn(element){\n\telement.unbind()\n}\n\nfunction showpartiel(show){\n\t$('#GuildMain div').hide();\n\n\t$('#' + show).show();\n}\n\nGUILD.display = function() {\n\twindow.location.hash = \"#guild\";\n\n\tremoveOn(GUILD.model)\n\tremoveOn(GUILD.collection)\n\tremoveOn(GUILD.collectionWar)\n\n\t/* --- chat --- */\n\tunsubAll();\n\t/* ------------ */\n\tnew GUILD.View({ model: GUILD.model, collection: GUILD.collection });\n\tnew GUILD.ViewMyGuild;\n\tnew GUILD.ViewHistory({\tel: '#guildHistory'});\n\tsubscGuild();\n\n}\n\n$(\"#nav input[value='Guild']\").on(\"click\", GUILD.display);\n\nexport default GUILD;\n\n"]},"metadata":{},"sourceType":"module"}